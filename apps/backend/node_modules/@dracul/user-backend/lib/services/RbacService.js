"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.rbacFactory = exports.UserRbacFactory = void 0;

var _loggerBackend = require("@dracul/logger-backend");

var _rbac = _interopRequireDefault(require("../rbac"));

var _RoleModel = _interopRequireDefault(require("../models/RoleModel"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const rbacFactory = function () {
  return new Promise((resolve, reject) => {
    _RoleModel.default.find({}).then(roles => {
      resolve(new _rbac.default(roles));
    }).catch(err => {
      _loggerBackend.DefaultLogger.error("RbacService.RbacFactory ", err);

      reject(err);
    });
  });
};

exports.rbacFactory = rbacFactory;

const UserRbacFactory = async function (user) {
  return new Promise((resolve, reject) => {
    rbacFactory().then(rbac => {
      if (user && user.role && user.role.name) {
        rbac.addUserRoles(user.id, [user.role.name]);
      } else {
        reject("UserRbacFactory need user.role.name");
      }

      resolve(rbac);
    }).catch(err => {
      _loggerBackend.DefaultLogger.error("RbacService.UserRbacFactory ", err);

      reject(err);
    });
  });
};

exports.UserRbacFactory = UserRbacFactory;